---
title: "Thesis Walkthrough"
author: "André Price"
date: "11/4/2020"
output: html_document
---

```{r setup, include=FALSE}
###Load Data###
rm(list=ls(all=TRUE)) 
setwd("~/Desktop/MasterR")
diets.original <- read.csv("Working_United.csv")
setwd("~/Desktop/MasterR")
isotope.original <- read.csv("isotopedata.csv")
```
```{r packages, include=FALSE}
##Needed installations
##install.packages(c("FSA","SIBER", "FSAdata", "ggrepel", "nlstools", "plotrix", "Rmisc", "siar", "tidyverse"))

###Packages##
library(SIBER)
library(dplyr)
library(ggplot2) 
library(tidyverse)
library(Rmisc)
library(gridExtra)
```
```{r wrangling, include=FALSE}

###Wrangle the Data####
colnames(diets.original)
colnames(diets.original)=c( "fishid","svspp","cruise6","station","pdsex","pdid","pdlen","pdwgt",   
                            "sizecat","pdgutw","pdgutv","fhdat","stratum","beglat","beglon","declat",  
                            "declon","month","day","year","purcode","season","geoarea","pynam",
                            "gencat","gensci","analcat","analsci","collcat","collsci","pynum","pyamtw",  
                            "pyamtv","pdscinam" ,"pdcomnam","location")

colnames(isotope.original)
colnames(isotope.original)=c("year", "month", "fishid", "c13l","n15l","c13m","n15m","c13s",    
                             "n15s","location","len","weight","sex","age","consumer")
isotopes_for_merge <- isotope.original[1:407, 1:14]

master_df <- merge(diets.original, isotopes_for_merge, by=c("fishid"), all.x = T)
colnames(master_df)

master_df <- select(master_df, -(contains(".y")))
master_df <- rename(master_df, c("year.x" = "year", "location.x"="location", "month.x"="month"))

```

```{r wrangling2, include=FALSE}
basics.n <- subset(master_df,select = -c(2:3,6,12:13,37:42))
basics.n$source <- ifelse(basics.n$geoarea=="", "ANDRE", "NOAA")
basics.n <- basics.n[!duplicated(basics.n$fishid), ]

##Reassign sex
basics.n$pdsex[basics.n$pdsex=="U"] <- "4"  #For mine, "U" meant trans
basics.n$pdsex[basics.n$pdsex=="F"] <- "2"
basics.n$pdsex[basics.n$pdsex=="M"] <- "1"
basics.n$pdsex[basics.n$pdsex=="4"] <- "4"  ### Becasue five NOAA fish were sexed as "4"
basics.n$pdsex[basics.n$pdsex==""] <- "0" ##Because it's still unknown

basics.n$sex.x <- ifelse(basics.n$pdsex == 0, 'Unknown',
                         ifelse(basics.n$pdsex == 1, 'Male',
                                ifelse(basics.n$pdsex == 2, 'Female',
                                       ifelse(basics.n$pdsex == 4, 'Trans', NA)))) #%>% 
transform(basics.n,sex.x=factor(basics.n$sex.x,levels=c("Unknown", "Female","Trans", "Male")))

##Then, either change or leave this
table(basics.n$pdsex, basics.n$source)
###Make a year deletion###
table(basics.n$year,basics.n$source)
basics.n <- basics.n[basics.n$year!="2017",]  
###NOAA data ends in 2016; I only had 10 unreliable samples in 2017
basics.n <- select(basics.n,-(sex))
basics.n <- rename(basics.n,c("sex.x" = "sex"))
#basics.n <- basics.n[basics.n$sex=="0"|basics.n$sex=="1"|basics.n$sex=="2"|basics.n$sex=="3",] 
basics.n$sizecat[basics.n$len<=25] <- "S"
basics.n$sizecat[basics.n$len>25] <- "M"
basics.n$sizecat[basics.n$len>50] <- "L"

##Location Type
basics.n$location_type<- ifelse(basics.n$location=="NB_ONE", "N",
                                ifelse(basics.n$location=="NB_TWO","N","A"))
##True age
basics.n$true_age<- ((basics.n$age)+((basics.n$mon-4)/12))
basics.n$true_age <- round(basics.n$true_age, digits = 4)

##I want to look at local MAB fish - None are caught in Winter anyway
basics.n <- filter(basics.n, geoarea=="MAB"| geoarea=="", year>2000)  ##last 10 years
basics.n <- filter(basics.n,season!="WINTER")
basics.n <-basics.n%>%mutate(Lati=trunc(beglat/100) + ((beglat-(trunc(beglat/100)*100))/100)*1.66 ) %>%
  mutate(Long=trunc(beglon/100)+ ((beglon-(trunc(beglon/100)*100))/100)*1.66) %>%
  mutate(Long=Long*-1)
table(basics.n$season)
table(basics.n$geoarea)
```
This working document that serves as a walkthough of my graduate thesis.

This study examines the trophic dynamics of 407 BSB sampled from natural and artificial reefs near Ocean City, MD, during 2016 and 2018 using hook-and-line angling.  Stomach content analyses indicate that crustaceans (primarily _Cancer borealis_ and _C. irroratus_) dominate diets of BSB at both natural and artificial reef types by proportion and by frequency of occurrence. Analysis of stable isotope ratios (∂^12^C/∂^13^C and ∂^14^N/∂^15^N) from three tissue types (i.e., liver, muscle, and mucus) showed that reef type had a significant effect on stable isotope values in all tissues except for ∂^15^N in mucus.  Across tissues types, fish at artificial sites showed slightly higher ∂^13^C values, indicative of littoral feeding. Different tissues vary in temporal integration, but differences in stable isotopes could not be attributed to definitive, consistent prey items. No significant differences in length, age, or sex ratios existed between reef types, indicating that the sorting of these characters was not the source of differences in stable isotopes. Gut content analysis shows that natural and artificial reefs are ecologically equivalent for BSB caught near Ocean City, MD, however, differences in stable isotopes suggests this is a more sensitive method that should be investigated further.


Here's a summary of the mean sizes of fish that were sampled

```{r summary of sizes, include=TRUE,warning=FALSE, echo=FALSE}
summarySE(basics.n, measurevar="pdlen", groupvars=c("source", "sex"), na.rm=TRUE)

```

This plot shows sample origin and quantity, and sex proportion.  This plot shows that females were most abundant, while males grew to an overall larger size.
```{r figure2, include=TRUE,warning=FALSE, echo=FALSE}
plot1a <- qplot(x=pdlen,y=..count../sum(..count..), data =basics.n[basics.n$source=="ANDRE",],
                geom = "histogram", binwidth = 0.5, fill=sex)+
  labs(x="Total Length (cm)", y="Proportion", col="Sex")+ggtitle("Length Frequencies of Black Sea Bass", subtitle = "A (n=407)")+
  theme(plot.title = element_text(hjust = 0.5))+xlim(0,60)
plot1a <- plot1a+scale_fill_manual(values=c("tomato1","dodgerblue4","aquamarine4" ,"grey48"), 
                                   name="Sex",labels=c("Female", "Male", "Trans", "Unknown"))

plot1b <- qplot(x=pdlen,y=..count../sum(..count..), data =basics.n[basics.n$source=="NOAA",],
                geom = "histogram", binwidth = 0.5, fill=sex)+
  labs(x="Total Length (cm)", y="Proportion", col="Sex")+ggtitle(NULL, subtitle = "B (n=1304)")+
  theme(plot.title = element_text(hjust = 0.5))+ylim(0,.100)
plot1b <- plot1b+scale_fill_manual(values=c("tomato1","dodgerblue4","aquamarine4" ,"grey48"), 
                                   name="Sex",labels=c("Female", "Male", "Trans", "Unknown"))

fig2 <- grid.arrange(plot1a, plot1b)
```

This will show a map of where samples were caught.  Samples were caught off the coast of MD, USA at natural and artifical sites.
```{r figure1, include=TRUE, ECHO=FALSE, WARNING=FALSE}
setwd("~/Desktop/MasterR")
mapsites<- read.csv("site_coordinates.csv")
mapsites$Long <- mapsites[, 2] + 0.006
mapsites$latlong <- paste(mapsites$Site, "|", mapsites$Year)

library(sf) 
library(rnaturalearth) 
library(rnaturalearthdata) 
library(ggplot2)


mapsites<- read.csv("site_coordinates.csv") 
mapsites$Long <- mapsites[, 2] + 0.2
mapsites$Year <- as.factor(mapsites$Year) 
world <- ne_countries(scale = "medium", returnclass = "sf") 
ggplot(data = world)+
  geom_sf()+
  geom_point(data= mapsites,aes(x = Long, y = Lat, color= Site, shape= Year))+
  labs(x="Long", y="Lat", colour="Site Type", shape="Year")+ 
  scale_color_manual(values=c("cyan3", "coral1"), 
                     labels=c("Nat","Art"))+ 
  scale_shape_manual(values=c(6,17))+
  coord_sf(xlim = c(-77, -73), ylim = c(37, 39), expand = FALSE)+ 
  annotate(geom = "text", x = -74.5, y = 37.25, label = "Atlantic Ocean", fontface = "italic", color = "grey22", size = 6)+ 
  xlab("Longitude") + 
  ylab("Latitude") + 
  ggtitle("Sampling Locations in 2016 and 2018")+
  theme(plot.title = element_text(hjust = 0.5))

```